<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÈÖíÈ¶ÜAI - ËßíËâ≤ÊâÆÊºî</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #fff;
            --tg-theme-text-color: #000;
            --tg-theme-hint-color: #999;
            --tg-theme-link-color: #ff69b4;
            --tg-theme-button-color: #ff69b4;
            --tg-theme-button-text-color: #fff;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Ubuntu;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            padding: 16px;
            max-width: 600px;
            margin: 0 auto;
            width: 100%;
            box-sizing: border-box;
            flex: 1;
        }

        .header {
            text-align: center;
            padding: 16px;
            border-bottom: 1px solid var(--tg-theme-hint-color);
        }

        .role-card {
            background: var(--tg-theme-bg-color);
            border: 1px solid var(--tg-theme-button-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .role-card:active {
            transform: scale(0.98);
        }

        .role-card.locked {
            filter: grayscale(1);
            opacity: 0.7;
        }

        .role-card.locked::before {
            content: 'üîí';
            position: absolute;
            right: 10px;
            top: 10px;
            font-size: 20px;
        }

        .role-header {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }

        .role-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 12px;
            background: var(--tg-theme-button-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
        }

        .role-title {
            flex: 1;
        }

        .role-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--tg-theme-button-color);
        }

        .role-subtitle {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        .role-description {
            font-size: 14px;
            color: var(--tg-theme-text-color);
            margin: 8px 0;
        }

        .role-info {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 8px;
        }

        .info-item {
            font-size: 12px;
            color: var(--tg-theme-hint-color);
            background: rgba(var(--tg-theme-button-color-rgb), 0.1);
            padding: 4px 8px;
            border-radius: 12px;
        }

        .tags {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .tag {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .cost {
            position: absolute;
            right: 10px;
            bottom: 10px;
            background: var(--tg-theme-button-color);
            color: #fff;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
        }

        .chat-container {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .messages {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .message {
            max-width: 80%;
            margin-bottom: 16px;
            padding: 12px;
            border-radius: 12px;
            position: relative;
        }

        .message.user {
            margin-left: auto;
            background: var(--tg-theme-button-color);
            color: #fff;
        }

        .message.bot {
            margin-right: auto;
            background: rgba(var(--tg-theme-button-color-rgb), 0.1);
            color: var(--tg-theme-text-color);
        }

        .input-container {
            padding: 16px;
            border-top: 1px solid var(--tg-theme-hint-color);
            display: none;
        }

        .input-row {
            display: flex;
            gap: 8px;
        }

        .message-input {
            flex: 1;
            padding: 12px;
            border: 1px solid var(--tg-theme-button-color);
            border-radius: 24px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-size: 16px;
            outline: none;
        }

        .send-button {
            padding: 12px 24px;
            background: var(--tg-theme-button-color);
            color: #fff;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            font-size: 16px;
        }

        .quick-actions {
            display: flex;
            gap: 8px;
            margin-bottom: 8px;
            overflow-x: auto;
            padding: 4px;
        }

        .action-button {
            padding: 8px 16px;
            background: rgba(var(--tg-theme-button-color-rgb), 0.1);
            color: var(--tg-theme-button-color);
            border: none;
            border-radius: 16px;
            cursor: pointer;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <div class="container" id="app">
        <div id="roles-container">
            <div class="header">
                <h1>üíù ÈÖíÈ¶ÜAI - ËßíËâ≤ÊâÆÊºî</h1>
                <p>ÈÄâÊã©‰Ω†ÁöÑÁêÜÊÉ≥ÂØπË±°ÂºÄÂßãÁîúËúú‰∫íÂä®~</p>
            </div>
        </div>
        <div id="chat-container" class="chat-container">
            <div id="messages" class="messages"></div>
            <div class="quick-actions" id="quickActions"></div>
            <div class="input-container" id="inputContainer">
                <div class="input-row">
                    <input type="text" class="message-input" id="messageInput" placeholder="ËØ¥ÁÇπ‰ªÄ‰πà...">
                    <button class="send-button" id="sendButton">ÂèëÈÄÅ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const webapp = window.Telegram.WebApp;
        webapp.ready();

        let currentRole = null;
        let userPoints = 0;

        const roles = {
            "seraphina": {
                name: "Â°ûÊãâËä¨Â®ú",
                title: "Ê∏©ÊüîÁîúÂøÉ",
                description: "ÁîúÁæéÂèØ‰∫∫ÁöÑÂ•≥ÂèãÔºåÊ∏©Êüî‰ΩìË¥¥ÔºåÂÖÖÊª°Áà±ÊÑè„ÄÇ",
                personality: "Ê∏©Êüî„ÄÅ‰ΩìË¥¥„ÄÅÁîúÁæé",
                appearance: "Ë∫´È´ò165cmÔºåÈïøÂèëÈ£òÈ£òÔºåÊòéÁú∏ÂñÑÁùê",
                tags: ["ÁîúÁæé", "Ê∏©Êüî", "ÂàùÊÅã"],
                cost: 0,
                interactions: ["Êä±Êä±", "‰∫≤‰∫≤", "Êë∏Â§¥", "Ë∞ÉÊÉÖ"]
            },
            "yuki": {
                name: "Èõ™Âß¨",
                title: "È´òÂÜ∑Âæ°Âßê",
                description: "Áü•ÊÄß‰ºòÈõÖÁöÑÂæ°ÂßêÔºåÂ§ñË°®È´òÂÜ∑ÂÜÖÂøÉÁÅ´ÁÉ≠„ÄÇ",
                personality: "È´òÂÜ∑„ÄÅÂÇ≤Â®á„ÄÅÊÄßÊÑü",
                appearance: "Ë∫´È´ò170cmÔºåÈªëÈïøÁõ¥ÔºåÊ∞îË¥®‰ºòÈõÖ",
                tags: ["Âæ°Âßê", "ÂÇ≤Â®á", "ÊÄßÊÑü"],
                cost: 100,
                interactions: ["Êä±Êä±", "‰∫≤‰∫≤", "Ë∞ÉÊÉÖ", "ÊííÂ®á"]
            }
        };

        function createRoleCard(id, role) {
            const card = document.createElement('div');
            card.className = `role-card ${role.cost > 0 ? 'locked' : ''}`;
            
            card.innerHTML = `
                <div class="role-header">
                    <div class="role-avatar">${role.name[0]}</div>
                    <div class="role-title">
                        <div class="role-name">${role.name}</div>
                        <div class="role-subtitle">${role.title}</div>
                    </div>
                </div>
                <div class="role-description">${role.description}</div>
                <div class="role-info">
                    <div class="info-item">üí´ ${role.personality}</div>
                    <div class="info-item">üëó ${role.appearance}</div>
                </div>
                <div class="tags">
                    ${role.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
                ${role.cost > 0 ? `<div class="cost">üí´ ${role.cost}</div>` : ''}
            `;

            card.addEventListener('click', () => selectRole(id, role));
            return card;
        }

        function selectRole(id, role) {
            currentRole = { id, ...role };
            
            document.getElementById('roles-container').style.display = 'none';
            document.getElementById('chat-container').style.display = 'flex';
            document.getElementById('inputContainer').style.display = 'block';
            
            setupQuickActions(role.interactions);
            
            webapp.sendData(JSON.stringify({
                action: 'select_role',
                roleId: id,
                roleName: role.name
            }));
        }

        function setupQuickActions(interactions) {
            const container = document.getElementById('quickActions');
            container.innerHTML = '';
            
            interactions.forEach(action => {
                const button = document.createElement('button');
                button.className = 'action-button';
                button.textContent = action;
                button.onclick = () => sendMessage(action);
                container.appendChild(button);
            });
        }

        function addMessage(text, type) {
            const message = document.createElement('div');
            message.className = `message ${type}`;
            message.textContent = text;
            
            const messages = document.getElementById('messages');
            messages.appendChild(message);
            messages.scrollTop = messages.scrollHeight;
        }

        function sendMessage(text) {
            if (!text.trim()) return;
            
            addMessage(text, 'user');
            webapp.sendData(JSON.stringify({
                action: 'send_message',
                roleId: currentRole.id,
                message: text
            }));

            if (text !== document.getElementById('messageInput').value) {
                document.getElementById('messageInput').value = '';
            }
        }

        function initApp() {
            const container = document.getElementById('roles-container');
            Object.entries(roles).forEach(([id, role]) => {
                container.appendChild(createRoleCard(id, role));
            });

            document.getElementById('sendButton').onclick = () => {
                const input = document.getElementById('messageInput');
                sendMessage(input.value);
                input.value = '';
            };

            document.getElementById('messageInput').onkeypress = (e) => {
                if (e.key === 'Enter') {
                    sendMessage(e.target.value);
                    e.target.value = '';
                }
            };

            // ËÆæÁΩÆ‰∏ªÈ¢òÈ¢úËâ≤
            const root = document.documentElement;
            root.style.setProperty('--tg-theme-bg-color', webapp.backgroundColor || '#fff');
            root.style.setProperty('--tg-theme-text-color', webapp.textColor || '#000');
            root.style.setProperty('--tg-theme-hint-color', webapp.hint_color || '#999');
            root.style.setProperty('--tg-theme-button-color', '#ff69b4');
            root.style.setProperty('--tg-theme-button-text-color', '#fff');
            
            // ÊèêÂèñ RGB ÂÄºÁî®‰∫éÈÄèÊòéÂ∫¶
            const buttonColor = getComputedStyle(root).getPropertyValue('--tg-theme-button-color');
            const rgb = buttonColor.match(/\d+/g);
            if (rgb) {
                root.style.setProperty('--tg-theme-button-color-rgb', rgb.join(','));
            }
        }

        initApp();
    </script>
</body>
</html>