<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DZMM | 大家都爱玩</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link rel="stylesheet" href="https://fastly.jsdelivr.net/npm/vant@4/lib/index.css" />
    <script src="https://fastly.jsdelivr.net/npm/vue@3"></script>
    <script src="https://fastly.jsdelivr.net/npm/vant@4/lib/vant.min.js"></script>
    <style>
        [v-cloak] {
            display: none;
        }

        :root {
            --tg-theme-bg-color: #ffffff;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #666666;
            --tg-theme-link-color: #ff69b4;
            --tg-theme-button-color: #ff69b4;
            --tg-theme-button-text-color: #ffffff;
            --card-bg-color: #f5f5f5;
        }

        body {
            background-color: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            margin: 0;
            padding: 0;
            min-height: 100vh;
        }

        .app-container {
            padding-bottom: 50px;
        }

        /* 顶部导航栏样式调整 */
        .nav-bar {
            background-color: var(--tg-theme-bg-color) !important;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 16px;
            position: relative;
            z-index: 1;
        }

        .nav-bar .app-title {
            font-size: 20px;
            font-weight: bold;
            color: var(--tg-theme-text-color);
        }

        .nav-bar .nav-icons {
            display: flex;
            align-items: center;
        }

        .nav-bar .nav-icons van-icon {
            margin-left: 16px;
        }

        /* 标题位置调整 */
        .title-container {
            text-align: center;
            padding: 16px 0;
            background-color: var(--tg-theme-bg-color);
            border-bottom: 1px solid #e0e0e0;
        }

        .title-container h1 {
            margin: 0;
            font-size: 24px;
            font-weight: bold;
            color: var(--tg-theme-text-color);
        }

        /* 标签导航栏样式 */
        .tag-nav {
            background-color: var(--tg-theme-bg-color);
            border-bottom: 1px solid #e0e0e0;
            padding: 8px 16px;
        }

        .tag-nav ul {
            list-style: none;
            margin: 0;
            padding: 0;
            display: flex;
            flex-wrap: wrap;
        }

        .tag-nav ul li {
            background-color: #f0f0f0;
            color: var(--tg-theme-text-color);
            border-radius: 4px;
            padding: 4px 8px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 12px;
        }

        .active-tab {
            color: var(--tg-theme-link-color);
        }

        /* 卡片样式调整 */
        .card {
            background: var(--card-bg-color);
            border-radius: 12px;
            margin: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
        }

        /* 图片修改为矩形 */
        .card-cover {
            width: 120px;
            height: 150px;
            object-fit: cover;
            margin-right: 12px;
        }

        .card-content {
            padding: 12px;
        }

        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .card-desc {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 8px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        .rating {
            color: #ff9800;
        }

        .heat {
            color: #f44336;
        }

        .author {
            color: var(--tg-theme-link-color);
        }

        .search-bar {
            padding: 8px 12px;
            background: var(--card-bg-color);
        }

        .tab-content {
            min-height: calc(100vh - 146px);
        }

        /* 底部导航栏样式调整 */
        .bottom-nav {
            background-color: var(--tg-theme-bg-color);
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            position: fixed;
            bottom: 0;
            width: 100%;
        }

        .bottom-nav a {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: var(--tg-theme-text-color);
        }

        .bottom-nav a van-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }

        .bottom-nav a span {
            font-size: 14px;
        }

        .active-tab {
            color: var(--tg-theme-link-color);
        }

        .card {
            background: var(--card-bg-color);
            border-radius: 12px;
            margin: 12px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card-cover {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .card-content {
            padding: 12px;
        }

        .card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .card-desc {
            font-size: 14px;
            color: var(--tg-theme-hint-color);
            margin-bottom: 8px;
        }

        .card-meta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 12px;
            color: var(--tg-theme-hint-color);
        }

        .rating {
            color: #ff9800;
        }

        .heat {
            color: #f44336;
        }

        .author {
            color: var(--tg-theme-link-color);
        }

        .search-bar {
            padding: 8px 12px;
            background: var(--card-bg-color);
        }

        .tab-content {
            min-height: calc(100vh - 146px);
        }
    </style>
</head>

<body>
    <div id="app" v-cloak>
        <!-- 标题部分 -->
        <div class="title-container">
            <h1>DZMM | 大家都爱玩</h1>
        </div>
        <!-- 导航栏 -->
        <div class="nav-bar">
            <div class="app-title">DZMM</div>
            <div class="nav-icons">
                <van-icon name="search" size="24" @click="showSearch = true" />
                <van-icon name="bell" size="24" style="margin-left: 16px" @click="showNotifications = true" />
                <van-icon :name="isDarkMode? 'moon-o' :'sunny-o'" size="24" style="margin-left: 16px"
                    @click="toggleDarkMode" />
                <image class="user-avatar" :src="userAvatar" :style="{ width: '30px', height: '30px', borderRadius: '50%' }" />
            </div>
        </div>

        <!-- 搜索弹窗 -->
        <van-popup v-model:show="showSearch" position="top" :style="{ height: '100%' }">
            <van-search
                v-model="searchValue"
                placeholder="搜索内容"
                show-action
                @cancel="showSearch = false"
            />
            <div class="search-results" v-if="searchValue">
                <!-- 搜索结果 -->
            </div>
        </van-popup>

        <!-- 通知弹窗 -->
        <van-popup v-model:show="showNotifications" position="right" :style="{ height: '100%', width: '80%' }">
            <van-nav-bar
                title="通知"
                left-arrow
                @click-left="showNotifications = false"
            />
            <van-pull-refresh v-model="refreshing" @refresh="onRefresh">
                <van-list
                    v-model:loading="loading"
                    :finished="finished"
                    finished-text="没有更多了"
                    @load="onLoad"
                >
                    <van-cell v-for="item in notifications" :key="item.id" :title="item.title" :label="item.content" />
                </van-list>
            </van-pull-refresh>
        </van-popup>

        <!-- 标签导航栏 -->
        <div class="tag-nav">
            <ul>
                <li class="active-tab">最新</li>
                <li>日榜</li>
                <li>周榜</li>
                <li>月榜</li>
                <li>总榜</li>
                <li>我的收藏</li>
                <li>#妈妈</li>
                <li>#ntr</li>
                <li>#世界</li>
                <li>#修仙</li>
                <li>#系统</li>
                <li>#姐姐</li>
                <li>#反差</li>
                <li>#母狗</li>
                <li>#催</li>
                <li>#明日方舟</li>
                <li>#老师</li>
                <li>#病娇</li>
                <li>#女仆</li>
                <li>#女帝</li>
                <li>#原神</li>
            </ul>
        </div>

        <!-- 主内容区 -->
        <div class="app-container" :style="{ paddingTop: '46px' }">
            <van-tabs v-model:active="activeTab" animated swipeable>
                <!-- 广场 -->
                <van-tab title="广场">
                    <div class="tab-content">
                        <van-pull-refresh v-model="refreshing" @refresh="onRefresh">
                            <van-list
                                v-model:loading="loading"
                                :finished="finished"
                                finished-text="没有更多了"
                                @load="onLoad"
                            >
                                <div class="card" v-for="item in items" :key="item.id" @click="openDetail(item)">
                                    <img :src="item.cover" class="card-cover" />
                                    <div class="card-content">
                                        <div class="card-title">{{ item.title }}</div>
                                        <div class="card-desc">{{ item.description }}</div>
                                        <div class="card-meta">
                                            <span class="rating">
                                                <van-rate v-model="item.rating" readonly allow-half size="12" />
                                                {{ item.rating }}
                                            </span>
                                            <span class="heat">
                                                <van-icon name="fire" />
                                                {{ item.heat }}
                                            </span>
                                            <span class="author">{{ item.author }}</span>
                                        </div>
                                    </div>
                                </div>
                            </van-list>
                        </van-pull-refresh>
                    </div>
                </van-tab>

                <!-- 会话 -->
                <van-tab title="会话">
                    <div class="tab-content">
                        <van-contact-list
                            v-model="selectedContact"
                            :list="contacts"
                            @add="onAdd"
                            @edit="onEdit"
                            @select="onSelect"
                        />
                    </div>
                </van-tab>

                <!-- 我的 -->
                <van-tab title="我的">
                    <div class="tab-content">
                        <van-cell-group inset>
                            <van-cell title="个人信息" is-link @click="openProfile" />
                            <van-cell title="我的收藏" is-link @click="openFavorites" />
                            <van-cell title="历史记录" is-link @click="openHistory" />
                            <van-cell title="设置" is-link @click="openSettings" />
                        </van-cell-group>
                    </div>
                </van-tab>
            </van-tabs>
        </div>
    </div>
    <!-- 底部导航栏 -->
    <div class="bottom-nav">
        <a href="#" class="nav-item">
            <van-icon name="home" />
            <span>广场</span>
        </a>
        <a href="#" class="nav-item">
            <van-icon name="chatbubble" />
            <span>会话</span>
        </a>
        <a href="#" class="nav-item">
            <van-icon name="user" />
            <span>我的</span>
        </a>
    </div>

    <script>
        const { createApp } = Vue;
        const webapp = window.Telegram.WebApp;
        webapp.ready();

        const app = createApp({
            data() {
                return {
                    activeTab: 0,
                    currentTitle: 'DZMM | 大家都爱玩',
                    isDarkMode: false,
                    showSearch: false,
                    showNotifications: false,
                    searchValue: '',
                    refreshing: false,
                    loading: false,
                    finished: false,
                    selectedContact: '',
                    items: [
                        {
                            id: 1,
                            title: "我多年未见的清纯青梅不...",
                            description: "在九霄仙域，灵雾缭绕，仙山悬浮，剑气纵横。你是这片仙域中天资卓绝的年轻修士，背负无尽传奇。而你的青梅竹马苏婉清，少时的苏婉清，容貌绝美，宛如仙子。她的身形纤细如柳，一",
                            cover: "https://picsum.photos/400/300?random=1",
                            rating: 5.0,
                            heat: 420,
                            author: "浮绘筆"
                        }
                    ],
                    contacts: [],
                    notifications: [],
                    userAvatar: '' // 这里可根据实际获取用户头像的方式设置
                };
            },
            methods: {
                toggleDarkMode() {
                    this.isDarkMode = !this.isDarkMode;
                    document.documentElement.style.setProperty(
                        '--tg-theme-bg-color',
                        this.isDarkMode? '#1a1a1a' : '#ffffff'
                    );
                    document.documentElement.style.setProperty(
                        '--tg-theme-text-color',
                        this.isDarkMode? '#ffffff' : '#000000'
                    );
                    document.documentElement.style.setProperty(
                        '--card-bg-color',
                        this.isDarkMode? '#2a2a2a' : '#f5f5f5'
                    );
                },
                async onRefresh() {
                    await this.loadData(true);
                    this.refreshing = false;
                },
                async onLoad() {
                    await this.loadData();
                    this.loading = false;
                },
                async loadData(refresh = false) {
                    if (refresh) {
                        this.items = [];
                    }
                    // 模拟加载数据
                    const newItems = [
                        {
                            id: this.items.length + 1,
                            title: '示例内容' + (this.items.length + 1),
                            description: '这是一个示例描述，展示内容的概要信息。',
                            cover: 'https://picsum.photos/400/300?random=' + (this.items.length + 1),
                            rating: 4.5,
                            heat: 1234,
                            author: '作者名称'
                        }
                    ];
                    this.items.push(...newItems);
                    if (this.items.length >= 20) {
                        this.finished = true;
                    }
                },
                openDetail(item) {
                    // 打开详情页
                    webapp.sendData(JSON.stringify({
                        action: 'open_detail',
                        itemId: item.id
                    }));
                },
                openProfile() {
                    webapp.sendData(JSON.stringify({
                        action: 'open_profile'
                    }));
                },
                openFavorites() {
                    webapp.sendData(JSON.stringify({
                        action: 'open_favorites'
                    }));
                },
                openHistory() {
                    webapp.sendData(JSON.stringify({
                        action: 'open_history'
                    }));
                },
                openSettings() {
                    webapp.sendData(JSON.stringify({
                        action: 'open_settings'
                    }));
                },
                onAdd() {
                    // 添加联系人
                },
                onEdit() {
                    // 编辑联系人
                },
                onSelect() {
                    // 选择联系人
                }
            },
            mounted() {
                this.loadData();
                // 设置 Telegram WebApp 主题
                webapp.setHeaderColor(this.isDarkMode? '#1a1a1a' : '#ffffff');
                webapp.setBackgroundColor(this.isDarkMode? '#1a1a1a' : '#ffffff');
            },
            watch: {
                activeTab(val) {
                    const titles = ['广场', '会话', '我的'];
                    this.currentTitle = val === 0? 'DZMM | 大家都爱玩' : titles[val];
                }
            }
        });

        // 注册 Vant 组件
        app.use(vant);
        app.mount('#app');
    </script>
</body>

</html>